---
title: "Tarea 2 - MCD - 2024"
subtitle: "Analisis descriptivo y textual de discografia de Soda Stereo üé∏"
author: "Agustin Gonzalez Lamenza"
date: last-modified
date-format: long
format: 
  html:
    toc: true
    number-sections: true
    code-fold: true
    df-print: paged
    embed-resources: true
    output-file: index.html
execute:
  echo: true
  warning: false
---

# Introducci√≥n
Soda Stereo no es solo una banda, es un √≠cono del rock en espa√±ol que marc√≥ a generaciones con su m√∫sica y poes√≠a. En este an√°lisis, exploramos a fondo su legado a trav√©s de datos y palabras, combinando herramientas modernas de an√°lisis para revelar patrones y secretos escondidos en sus canciones y letras.

La idea es entender no solo la m√∫sica, sino tambi√©n las emociones y mensajes que transmiten sus letras. ¬øQu√© tan energ√©ticas son sus canciones? ¬øQu√© palabras se repiten con m√°s frecuencia? ¬øQu√© sentimientos predominan en su discograf√≠a? Estas son algunas de las preguntas que buscamos responder.

![Soda Stereo en acci√≥n](https://upload.wikimedia.org/wikipedia/commons/0/0c/Soda_Stereo_%2784.png)  
*Figura 1: Soda Stereo, una banda que transform√≥ la m√∫sica en arte.*

# Carga de packages y datos
Este bloque de c√≥digo carga todos los paquetes necesarios para realizar el an√°lisis y tambi√©n lee los archivos de datos que contienen la informaci√≥n sobre las canciones y las letras. Se asegura de eliminar duplicados en los conjuntos de datos antes de hacer la uni√≥n entre las canciones y las letras, lo que es importante para evitar inconsistencias en el an√°lisis.

```{r}
# Lista de paquetes a instalar
library(tidyverse)
library(ggplot2)
library(wordcloud)
library(tidytext)
library(textdata)
library(stopwords)
library(here)
library(pastecs)
library(psych)

# Carga de los datos
songs <- read_tsv(here("data", "songs.tsv"))
lyrics <- read_tsv(here("data", "lyrics.tsv"))

songs_unique <- songs %>%
  distinct(track_name, .keep_all = TRUE)

lyrics_unique <- lyrics %>%
  distinct(song_name, .keep_all = TRUE)

# Realizar el join despu√©s de eliminar duplicados
data <- songs_unique %>%
  mutate(track_name = str_to_lower(track_name)) %>%
  inner_join(
    lyrics_unique %>% mutate(song_name = str_to_lower(song_name)),
    by = c("track_name" = "song_name")
  )
```

## Dataframe songs
Aqu√≠ se muestra el primer vistazo a los datos de las canciones, con un formato HTML que incluye un truncamiento de texto y tooltips. Esto es √∫til para ver r√°pidamente los nombres de las canciones sin que la tabla se vuelva demasiado larga o desordenada.

```{r}
songs_unique %>%
  head() %>%
  mutate(across(everything(), ~ paste0(
    '<span title="', ., '" style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">',
    substr(., 1, 40), "...</span>"
  ))) %>%
  knitr::kable("html", escape = FALSE)
```

## Dataframe lyrics
Similar al bloque anterior, esta secci√≥n muestra las primeras filas del dataframe de letras con un formato visual similar, proporcionando un vistazo a las canciones y sus letras de manera compacta.

```{r}
lyrics_unique %>%
  head() %>%
  mutate(across(everything(), ~ paste0(
    '<span title="', ., '" style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">',
    substr(., 1, 60), "...</span>"
  ))) %>%
  knitr::kable("html", escape = FALSE)
```

# An√°lisis descriptivo

## Distribuci√≥n de duraci√≥n de las canciones
Este gr√°fico muestra c√≥mo se distribuyen las duraciones de las canciones. La visualizaci√≥n usa un histograma, lo que ayuda a entender la variabilidad en los tiempos de las canciones y ver si hay una tendencia hacia canciones m√°s largas o m√°s cortas.

```{r}
ggplot(data, aes(x = track_duration_ms / 1000)) +
  geom_histogram(binwidth = 30, fill = "steelblue", color = "white") +
  labs(
    title = "Distribuci√≥n de la duraci√≥n de las canciones",
    x = "Duraci√≥n (segundos)",
    y = "Frecuencia"
  ) +
  theme_minimal()
```

## Relaci√≥n entre energ√≠a y bailabilidad
Aqu√≠ se explora c√≥mo se relacionan las m√©tricas de energ√≠a y bailabilidad de las canciones. El gr√°fico de dispersi√≥n con una l√≠nea de regresi√≥n ayuda a visualizar si las canciones m√°s energ√©ticas tienden a ser tambi√©n m√°s bailables, lo cual puede ofrecer informaci√≥n interesante sobre el estilo de las canciones.

```{r}
ggplot(data, aes(x = track_energy, y = track_danceability)) +
  geom_point(alpha = 0.7, color = "darkorange") +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "Relaci√≥n entre energ√≠a y bailabilidad",
    x = "Energ√≠a",
    y = "Bailabilidad"
  ) +
  theme_minimal()
```

## Estad√≠sticas descriptivas de features numericos
Esta secci√≥n calcula estad√≠sticas descriptivas para las caracter√≠sticas num√©ricas de las canciones (por ejemplo, duraci√≥n, energ√≠a, etc.). Presentar los valores promedio, m√≠nimo, m√°ximo, etc., nos da una idea de c√≥mo son los datos en t√©rminos de estos atributos.

```{r}
numerical_features <- songs_unique %>%
  select(where(is.numeric))

res <- pastecs::stat.desc(numerical_features) %>%
  as.matrix() %>%
  as.data.frame() %>%
  round(2)

res <- format(res, scientific = FALSE)

knitr::kable(data.frame(res), digits = 2)
```

## Grafico de correlaci√≥n

```{r}
pairs.panels(numerical_features,
  method = "pearson",
  hist.col = "#00AFBB",
  density = TRUE,
  ellipses = F
)
```

# An√°lisis textual

## Establecer una semilla para reproducibilidad
Aqu√≠ se establece una semilla para asegurar que el an√°lisis de las palabras sea reproducible, lo que es importante para obtener los mismos resultados si se vuelve a ejecutar el an√°lisis en el futuro.

```{r}
set.seed(123)
```

## Frecuencia de palabras
En este bloque se crea una lista de las palabras m√°s frecuentes en las letras de las canciones, despu√©s de eliminar las palabras vac√≠as (stopwords) y algunas otras espec√≠ficas de Soda Stereo. El gr√°fico resultante muestra cu√°les son las palabras m√°s recurrentes, lo que puede decirnos mucho sobre los temas recurrentes en las canciones.

```{r}
stopwords_es <- stopwords("es")

# Crear un vector con las stopwords adicionales
# Sumo algo muy repetitivo en Soda (solo valido para Soda)
stopwords_adicionales <- c("ay", "oh")

stopwords_completas <- c(stopwords_es, stopwords_adicionales)

tokens <- data %>%
  unnest_tokens(word, lyrics) %>%
  anti_join(tibble(word = stopwords_completas), by = "word") %>%
  count(word, sort = TRUE)

tokens %>%
  top_n(20) %>%
  ggplot(aes(x = reorder(word, n), y = n)) +
  geom_col(fill = "purple") +
  coord_flip() +
  labs(
    title = "Palabras m√°s frecuentes en las letras",
    x = "Palabras",
    y = "Frecuencia"
  ) +
  theme_minimal()
```

## Nube de palabras

```{r}
wordcloud::wordcloud(
  words = tokens$word,
  freq = tokens$n,
  max.words = 100,
  colors = brewer.pal(8, "Dark2")
)
```

## An√°lisis de sentimientos
Aqu√≠ se utiliza el l√©xico NRC para analizar los sentimientos presentes en las letras de las canciones. Los sentimientos son clasificados y contados, luego visualizados en un gr√°fico para mostrar cu√°l es el tono predominante (positivo, negativo, etc.) en las letras.

```{r}
# An√°lisis de sentimientos usando el l√©xico NRC
sentiments <- tokens %>%
  inner_join(get_sentiments("nrc"), by = "word") %>%
  count(sentiment, sort = TRUE)

ggplot(sentiments, aes(x = reorder(sentiment, n), y = n)) +
  geom_col(fill = "skyblue") +
  coord_flip() +
  labs(
    title = "Distribuci√≥n de sentimientos en las letras",
    x = "Sentimiento",
    y = "Frecuencia"
  ) +
  theme_minimal()
```

## Nube de palabras de sentimientos

```{r}
wordcloud::wordcloud(
  words = sentiments$sentiment,
  freq = sentiments$n,
  min.freq = 1,
  colors = brewer.pal(8, "Dark2"),
)
```

# Concusi√≥n
Soda Stereo es un viaje emocional. Sus letras est√°n llenas de sentimientos intensos, donde la tristeza, la melancol√≠a y la introspecci√≥n tienen un gran protagonismo. Es interesante ver c√≥mo manejan un equilibrio entre lo oscuro y lo luminoso. Por un lado, hay mucha nostalgia y hasta algo de enojo en sus canciones, pero por otro lado, tambi√©n transmiten confianza y una b√∫squeda constante de algo m√°s, como si siempre hubiera esperanza al final.

Algo que llama la atenci√≥n es c√≥mo combinan temas tan humanos con su sonido caracter√≠stico, que puede ser suave y envolvente, pero tambi√©n salvaje e intenso. No son canciones hechas solo para escuchar, sino para sentirlas. Tal vez por eso muchas de sus letras se quedan en la cabeza, porque realmente logran conectar con las emociones de quien las escucha.

En pocas palabras, Soda Stereo no solo hizo m√∫sica, cre√≥ momentos y emociones que siguen vigentes. Hablar de ellos es hablar de poes√≠a hecha canci√≥n, algo que muy pocas bandas logran.